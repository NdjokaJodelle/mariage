<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu du Mariage</title>
    <link rel="stylesheet" href="app.css">
</head>
<body>
    <div class="page-container">
        <div class="page-header">
            <div class="icon">üçΩÔ∏è</div>
            <h1>Menu du Jour</h1>
            <p class="subtitle">D√©couvrez les d√©lices qui vous attendent</p>
            <a href="#" id="backButton" class="back-button">‚Üê Retour √† l'accueil</a>
        </div>

        <div id="menuContent">
            <div class="loading" style="text-align: center; padding: 40px;">
                <p>üîÑ Chargement du menu...</p>
            </div>
        </div>
    </div>

    <script>
        // Configuration des cat√©gories du menu
        const MENU_CATEGORIES = [
            {
                folder: "Cocktail_de_bienvenue",
                title: "ü•Ç Cocktail de Bienvenue",
                icon: "ü•Ç"
            },
            {
                folder: "Entrees",
                title: "ü•ó Entr√©es",
                icon: "ü•ó"
            },
            {
                folder: "Plats_principaux",
                title: "üçñ Plats Principaux",
                icon: "üçñ"
            },
            {
                folder: "Accompagnements",
                title: "ü•î Accompagnements",
                icon: "ü•î"
            },
            {
                folder: "Desserts",
                title: "üç∞ Desserts",
                icon: "üç∞"
            },
            {
                folder: "Boissons",
                title: "üç∑ Boissons",
                icon: "üç∑"
            }
        ];

        // Fonction pour v√©rifier l'authentification
        function checkAuth() {
            const user = sessionStorage.getItem('currentUser');
            if (!user) {
                window.location.href = 'index.html';
                return null;
            }
            return JSON.parse(user);
        }

        // Fonction pour convertir le nom de fichier en nom lisible
        function formatDishName(filename) {
            // Enlever l'extension .png
            let name = filename.replace('.png', '');
            
            // Remplacer les underscores par des espaces
            name = name.replace(/_/g, ' ');
            
            // Mettre la premi√®re lettre de chaque mot en majuscule
            name = name.split(' ')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
            
            return name;
        }

        // Fonction pour charger les images d'un dossier
        async function loadImagesFromFolder(folderPath) {
            try {
                // Liste des images √† chercher (vous devrez adapter selon vos fichiers r√©els)
                // Cette approche n√©cessite de conna√Ætre les noms √† l'avance
                // OU d'avoir un fichier index.json dans chaque dossier
                
                // Tentative de chargement d'un fichier index
                const indexPath = `${folderPath}/index.json`;
                const response = await fetch(indexPath);
                
                if (response.ok) {
                    const data = await response.json();
                    return data.images || [];
                } else {
                    // Fallback : retourner un tableau vide si pas d'index
                    console.warn(`Pas d'index.json trouv√© pour ${folderPath}`);
                    return [];
                }
            } catch (error) {
                console.error(`Erreur de chargement pour ${folderPath}:`, error);
                return [];
            }
        }

        // Fonction pour cr√©er une carte de plat
        function createDishCard(imageName, folderPath) {
            const card = document.createElement('div');
            card.className = 'grid-item';
            
            const imagePath = `${folderPath}/${imageName}`;
            const dishName = formatDishName(imageName);
            
            card.innerHTML = `
                <img src="${imagePath}" 
                     alt="${dishName}" 
                     onerror="this.style.display='none'; this.nextElementSibling.innerHTML='<p style=&quot;padding:20px;text-align:center;color:#999;&quot;>üì∑ Image non disponible</p>';">
                <div class="grid-item-content">
                    <h3>${dishName}</h3>
                </div>
            `;
            
            return card;
        }

        // Fonction pour cr√©er une section de menu
        async function createMenuSection(category) {
            const section = document.createElement('div');
            section.className = 'content-card';
            
            const title = document.createElement('h2');
            title.textContent = category.title;
            section.appendChild(title);
            
            const grid = document.createElement('div');
            grid.className = 'grid-container';
            
            const folderPath = `menu/${category.folder}`;
            const images = await loadImagesFromFolder(folderPath);
            
            if (images.length === 0) {
                // Message si aucune image
                const emptyMessage = document.createElement('p');
                emptyMessage.style.textAlign = 'center';
                emptyMessage.style.color = '#999';
                emptyMessage.style.padding = '20px';
                emptyMessage.textContent = 'Aucun plat disponible dans cette cat√©gorie pour le moment.';
                section.appendChild(emptyMessage);
            } else {
                images.forEach(imageName => {
                    const card = createDishCard(imageName, folderPath);
                    grid.appendChild(card);
                });
                section.appendChild(grid);
            }
            
            return section;
        }

        // Fonction pour afficher le menu complet
        async function renderMenu() {
            const container = document.getElementById('menuContent');
            container.innerHTML = '';
            
            // Ajouter une introduction
            const intro = document.createElement('div');
            intro.className = 'content-card';
            intro.innerHTML = `
                <h2>Un festin pour c√©l√©brer notre union</h2>
                <p>Nous avons pr√©par√© avec soin un menu raffin√© pour r√©galer vos papilles. 
                Chaque plat a √©t√© s√©lectionn√© avec amour pour faire de cette journ√©e un moment inoubliable.</p>
                <p><strong>Note :</strong> Si vous avez des allergies ou des pr√©f√©rences alimentaires, 
                n'h√©sitez pas √† en informer le personnel.</p>
            `;
            container.appendChild(intro);
            
            // Ajouter chaque section du menu
            for (const category of MENU_CATEGORIES) {
                const section = await createMenuSection(category);
                container.appendChild(section);
            }
            
            // Message de fin
            const outro = document.createElement('div');
            outro.className = 'content-card';
            outro.style.textAlign = 'center';
            outro.innerHTML = `
                <h2>Bon app√©tit ! üéâ</h2>
                <p>Nous esp√©rons que vous appr√©cierez ce repas autant que nous avons pris plaisir √† le pr√©parer pour vous.</p>
            `;
            container.appendChild(outro);
        }

        // Initialisation de la page
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('üìÑ Page Menu charg√©e');
            
            // V√©rifier l'authentification
            const user = checkAuth();
            if (!user) {
                return;
            }
            
            // Configurer le bouton retour avec le token
            const token = sessionStorage.getItem('authToken');
            const backButton = document.getElementById('backButton');
            if (backButton && token) {
                backButton.href = `index.html?token=${token}`;
            }
            
            console.log('üë§ Utilisateur:', user.name);
            
            // Afficher le menu
            await renderMenu();
            
            console.log('‚úÖ Menu affich√©');
        });
    </script>
</body>
</html>